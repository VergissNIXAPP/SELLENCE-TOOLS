<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SELLENCE-TOURENPLANER</title>
  <meta name="theme-color" content="#5B2EFF" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <link rel="icon" href="./icons/icon-192.png" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg-orb orb1"></div>
  <div class="bg-orb orb2"></div>
  <div class="bg-orb orb3"></div>

  <header class="topbar">
    
    <a class="backBtn backBtn--icon" href="../index.html" title="ZurÃ¼ck zu SELLENCE Tools"><span class="backIcon">â†</span></a>
<div class="brand">
      <div class="brand-mark" aria-hidden="true">
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M12 40c10-18 26-16 40-28" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
          <path d="M30 46c7-8 15-12 26-16" stroke="rgba(255,255,255,.62)" stroke-width="6" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <div class="brand-title">SELLENCE</div>
        <div class="brand-sub">TOURENPLANER</div>
      </div>
    </div>
    
    <div class="top-actions">
      <button class="btn" id="shareBtn" aria-label="Teilen" title="Teilen">â¤´ï¸</button>
      <button class="btn" id="menuBtn" aria-label="MenÃ¼" title="MenÃ¼">â˜°</button>
      <div class="menu" id="menuPanel" aria-hidden="true">
        <button class="btn" id="btnAddMarket">â• Markt hinzufÃ¼gen</button>
        <button class="btn" id="btnImport">ğŸ“¥ Excel Import</button>
        <button class="btn" id="btnGeocode" title="Adressen â†’ Koordinaten (OpenStreetMap)">ğŸ§­ Geocoding</button>
        <button class="btn danger" id="btnClearAll">Alles lÃ¶schen</button>
      </div>
      <input type="file" id="fileInput" accept=".xlsx,.xls" hidden />
    </div>

  </header>

  <main class="shell">
    <div class="grid two">
      <section class="card">
        <div class="card-h">
          <div>
            <h2>Karte / MÃ¤rkte</h2>
          </div>
          <div class="pill" id="marketCount">0</div>
        </div>

        <div class="row">
          <label class="field" style="min-width:260px;flex:2">
            <span>SAP-Nr. Suche</span>
            <input id="sapSearch" placeholder="z.B. 2011556" inputmode="numeric" autocomplete="off" />
          </label>
          <button class="btn primary" id="btnFind">Suchen</button>
          <button class="btn" id="btnFit">â†”ï¸ Alles anzeigen</button>
        </div>

        <div class="how" style="margin-top:10px">
          <button class="btn" id="btnHow" type="button">So funktioniertâ€™s</button>
          <div class="note how-panel" id="howPanel" hidden>
            <ol style="margin:0; padding-left:18px; display:flex; flex-direction:column; gap:6px">
              <li><b>Excel-Import</b>: Kundenliste hochladen.</li>
              <li><b>Geotagging</b>: â€Geocodingâ€œ starten (kann je nach Anzahl etwas dauern).</li>
              <li><b>Aktualisieren</b>: Seite neu laden â€“ danach siehst du alle MÃ¤rkte als Marker auf der Karte.</li>
              <li><b>Planung</b>: SAPâ€‘Nummer suchen (wie in Ninox geplant) â†’ Marker anklicken â†’ <b>â€In Route +â€œ</b>.</li>
              <li><b>Fertigstellen</b>: â€Planung fertigstellenâ€œ â†’ Route wird automatisch optimiert und ist bereit fÃ¼r Google Maps.</li>
            </ol>
          </div>
        </div>

        <div class="hr"></div>
        <div id="map" class="map"></div>
      </section>

      <section class="card">
        <div class="card-h">
          <div>
            <h2>Routenplaner mit allen MÃ¤rkten</h2>
          </div>
        </div>

        <div class="row">
          <button class="btn primary" id="btnFinalize">âœ… Planung fertigstellen</button>
          <button class="btn primary" id="btnStartMaps" disabled>ğŸ§­ Starten (Google Maps)</button>
          <button class="btn" id="btnResetRoute">â†©ï¸ ZurÃ¼cksetzen</button>
        </div>

        <label class="check" for="chkReturn" style="margin-top:8px">
          <input type="checkbox" id="chkReturn" checked />
          <span class="checkDot" aria-hidden="true"></span>
          <span class="checkText">Startpunkt als letzten Stopp hinzufÃ¼gen (RÃ¼ckfahrt)</span>
        </label>
        <div class="muted tiny" id="returnHint" style="margin-top:4px">
          Aktiv: Die Tour endet wieder am Startpunkt.
        </div>

        <div class="status" id="status" aria-live="polite"></div>

        <div class="kpi">
          <div class="box"><div class="muted tiny">Stops</div><div class="v" id="kStops">0</div></div>
          <div class="box"><div class="muted tiny">Tour km</div><div class="v" id="kKm">â€”</div></div>
        </div>

        <div class="hr"></div>
        <div class="list" id="routeList"></div>

        <div class="note" style="margin-top:12px">
          <b>Tipp:</b> Einmal â€Geocodingâ€œ laufen lassen, dann sind alle Marker & die Optimierung stabil.
        </div>
      </section>
    </div>
  </main>

  <!-- Defer scripts so DOM (incl. modal) exists before app.js wires event listeners -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script defer src="./app.js"></script>

  <!-- Modal: Markt hinzufÃ¼gen -->
  <div class="modal" id="addMarketModal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modalCard" role="document">
      <div class="modalHead">
        <div>
          <div class="modalTitle">Markt hinzufÃ¼gen</div>
          <div class="muted tiny">Name, Adresse & SAPâ€‘Nummer eintragen â€“ Geocoding lÃ¤uft automatisch.</div>
        </div>
        <button class="btn" id="btnAddMarketClose" aria-label="SchlieÃŸen">âœ•</button>
      </div>

      <div class="modalBody">
        <label class="field">
          <span>Marktname</span>
          <input id="amName" placeholder="z.B. EDEKA JÃ¼rgensen" autocomplete="off" />
        </label>
        <label class="field">
          <span>Adresse</span>
          <input id="amAddr" placeholder="StraÃŸe, PLZ Ort" autocomplete="off" />
        </label>
        <label class="field">
          <span>SAPâ€‘Nummer</span>
          <input id="amSap" placeholder="z.B. 2011556" inputmode="numeric" autocomplete="off" />
        </label>
      </div>

      <div class="modalActions">
        <button class="btn" id="btnAddMarketCancel">Abbrechen</button>
        <button class="btn primary" id="btnAddMarketSave">Speichern</button>
      </div>

      <div class="status" id="addMarketStatus" aria-live="polite"></div>
    </div>
  </div>
</body>
</html>
