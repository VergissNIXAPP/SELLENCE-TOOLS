<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SELLENCE-TOURENPLANER</title>
  <meta name="theme-color" content="#5B2EFF" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <link rel="icon" href="./icons/icon-192.png" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg-orb orb1"></div>
  <div class="bg-orb orb2"></div>
  <div class="bg-orb orb3"></div>

  <header class="topbar">
    
    <a class="backBtn backBtn--icon" href="../index.html" title="ZurÃ¼ck zu SELLENCE Tools"><span class="backIcon">â†</span></a>
<div class="brand">
      <div class="brand-mark" aria-hidden="true">
        <svg viewBox="0 0 64 64" fill="none">
          <path d="M12 40c10-18 26-16 40-28" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
          <path d="M30 46c7-8 15-12 26-16" stroke="rgba(255,255,255,.62)" stroke-width="6" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <div class="brand-title">SELLENCE</div>
        <div class="brand-sub">TOURENPLANER</div>
      </div>
    </div>
    
    <div class="top-actions">
      <button class="btn" id="menuBtn" aria-label="MenÃ¼" title="MenÃ¼">â˜°</button>
      <div class="menu" id="menuPanel" aria-hidden="true">
        <button class="btn" id="btnAddMarket">â• Markt hinzufÃ¼gen</button>
        <button class="btn" id="btnImport">ğŸ“¥ Excel Import</button>
        <button class="btn" id="btnGeocode" title="Adressen â†’ Koordinaten (OpenStreetMap)">ğŸ§­ Geocoding</button>
        <button class="btn" id="btnFahrdaten">ğŸ“Š Fahrdaten</button>
        <button class="btn danger" id="btnClearAll">Alles lÃ¶schen</button>
      </div>
      <input type="file" id="fileInput" accept=".xlsx,.xls" hidden />
    </div>

  </header>

  <main class="shell">
    <div class="grid two">
      <section class="card">
        <div class="card-h">
          <div>
            <h2>Karte / MÃ¤rkte</h2>
          </div>
          <div class="pill" id="marketCount">0</div>
        </div>

        <div class="row">
          <label class="field" style="min-width:260px;flex:2">
            <span>SAP-Nr. (einzeln oder mehrere)</span>
            <input id="sapSearch" placeholder="z.B. 2011556 oder: 2011556 2011504 2551974" inputmode="numeric" autocomplete="off" />
            <small class="hint">Mehrere SAPâ€‘Nummern einfach mit Leerzeichen, Komma oder Zeilenumbruch trennen â€“ sie werden direkt in die Planung Ã¼bernommen.</small>
          </label>
          <button class="btn primary" id="btnFind">Ãœbernehmen</button>
          <button class="btn" id="btnFit">â†”ï¸ Alles anzeigen</button>
        </div>

        <div class="how" style="margin-top:10px">
          <button class="btn" id="btnHow" type="button">So funktioniertâ€™s</button>
          <div class="note how-panel" id="howPanel" hidden>
            <ol style="margin:0; padding-left:18px; display:flex; flex-direction:column; gap:6px">
              <li><b>Excel-Import</b>: Kundenliste hochladen.</li>
              <li><b>Geotagging</b>: â€Geocodingâ€œ starten (kann je nach Anzahl etwas dauern).</li>
              <li><b>Aktualisieren</b>: Seite neu laden â€“ danach siehst du alle MÃ¤rkte als Marker auf der Karte.</li>
              <li><b>Planung</b>: SAPâ€‘Nummer(n) einfÃ¼gen â†’ <b>â€Ãœbernehmenâ€œ</b> (landet direkt in der Route).</li>
              <li><b>Fertigstellen</b>: â€Planung fertigstellenâ€œ â†’ Route wird automatisch optimiert und ist bereit fÃ¼r Google Maps.</li>
            </ol>
          </div>
        </div>

        <div class="hr"></div>
        <div id="map" class="map"></div>
      </section>

      <section class="card">
        <div class="card-h">
          <div>
            <h2>Navigation: Stop fÃ¼r Stop</h2>
          </div>
        </div>

        <div class="row">
          <button class="btn primary" id="btnFinalize">âœ… Planung fertigstellen</button>
          <button class="btn primary" id="btnStartMaps" disabled>â–¶ï¸ Starten (Stop fÃ¼r Stop)</button>
          <button class="btn" id="btnResetRoute">â†©ï¸ ZurÃ¼cksetzen</button>
        
        <div class="navCard" id="navCard" hidden>
          <div class="navTop">
            <div>
              <div class="navKicker">Aktueller Stopp</div>
              <div class="navTitle" id="navTitle">â€”</div>
              <div class="navAddr" id="navAddr">â€”</div>
            </div>
            <div class="navCounter" id="navCounter">0 / 0</div>
          </div>

          <div class="navBtns">
            <button class="btn primary" id="btnOpenMaps">ğŸ—ºï¸ Ã–ffnen in Google Maps</button>
            <button class="btn" id="btnPrevStop">â† ZurÃ¼ck</button>
            <button class="btn ok" id="btnArrived">âœ… Angekommen</button>
            <button class="btn" id="btnNextStop">Weiter â†’</button>
          </div>

          <div class="muted tiny" id="navHint" style="margin-top:6px">
            Tipp: Du kannst die Reihenfolge flexibel Ã¤ndern â€“ erst in der Liste, oder hier mit ZurÃ¼ck/Weiter.
          </div>
        </div>

</div>

        <label class="check" for="chkReturn" style="margin-top:8px">
          <input type="checkbox" id="chkReturn" checked />
          <span class="checkDot" aria-hidden="true"></span>
          <span class="checkText">Startpunkt als letzten Stopp hinzufÃ¼gen (RÃ¼ckfahrt)</span>
        </label>
        <div class="muted tiny" id="returnHint" style="margin-top:4px">
          Aktiv: Die Tour endet wieder am Startpunkt.
        </div>

        <div class="status" id="status" aria-live="polite"></div>

        <div class="kpi">
          <div class="box"><div class="muted tiny">Stops</div><div class="v" id="kStops">0</div></div>
          <div class="box"><div class="muted tiny">Tour km</div><div class="v" id="kKm">â€”</div></div>
        </div>

        <div class="hr"></div>
        <div class="list" id="routeList"></div>

        <div class="note" style="margin-top:12px">
          <b>Tipp:</b> Einmal â€Geocodingâ€œ laufen lassen, dann sind alle Marker & die Optimierung stabil.
        </div>
      </section>
    </div>
  </main>

  <!-- Defer scripts so DOM (incl. modal) exists before app.js wires event listeners -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script defer src="./app.js"></script>

  <!-- Modal: Markt hinzufÃ¼gen -->
  <div class="modal" id="addMarketModal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modalCard" role="document">
      <div class="modalHead">
        <div>
          <div class="modalTitle">Markt hinzufÃ¼gen</div>
          <div class="muted tiny">Name, Adresse & SAPâ€‘Nummer eintragen â€“ Geocoding lÃ¤uft automatisch.</div>
        </div>
        <button class="btn" id="btnAddMarketClose" aria-label="SchlieÃŸen">âœ•</button>
      </div>

      <div class="modalBody">
        <label class="field">
          <span>Marktname</span>
          <input id="amName" placeholder="z.B. EDEKA JÃ¼rgensen" autocomplete="off" />
        </label>
        <label class="field">
          <span>Adresse</span>
          <input id="amAddr" placeholder="StraÃŸe, PLZ Ort" autocomplete="off" />
        </label>
        <label class="field">
          <span>SAPâ€‘Nummer</span>
          <input id="amSap" placeholder="z.B. 2011556" inputmode="numeric" autocomplete="off" />
        </label>
      </div>

      <div class="modalActions">
        <button class="btn" id="btnAddMarketCancel">Abbrechen</button>
        <button class="btn primary" id="btnAddMarketSave">Speichern</button>
      </div>

      <div class="status" id="addMarketStatus" aria-live="polite"></div>
    </div>
  </div>
</body>
</html>


        <!-- =======================
             Tour-Historie
        ======================== -->
        <section class="card" id="historyCard" style="margin-top:14px">
          <div class="card-head">
            <h2>ğŸ“š Tourâ€‘Historie</h2>
            <p class="muted">Wird automatisch gespeichert, sobald du auf â€Startenâ€œ drÃ¼ckst.</p>
          </div>

          <div class="history-controls">
            <div class="field">
              <label for="hFrom">Von</label>
              <input type="date" id="hFrom" />
            </div>
            <div class="field">
              <label for="hTo">Bis</label>
              <input type="date" id="hTo" />
            </div>

            <div class="history-actions">
              <button class="btn" id="btnRangeToday">Heute</button>
              <button class="btn" id="btnRangeWeek">Woche</button>
              <button class="btn" id="btnRangeMonth">Monat</button>
              <button class="btn" id="btnExportCsv">CSV export</button>
              <button class="btn" id="btnPrintHistory">Drucken</button>
              <button class="btn danger" id="btnClearHistory" title="LÃ¶scht nur die Historie auf diesem GerÃ¤t">Historie lÃ¶schen</button>
            </div>
          </div>

          <div class="history-summary">
            <div><b>Gefahrene Kilometer:</b> <span id="hKm">â€”</span></div>
            <div><b>Gespeicherte Touren:</b> <span id="hTours">0</span></div>
          </div>

          <div id="historyList" class="history-list"></div>
        </section>


<!-- Fahrdaten Drawer -->
<div id="fahrdatenDrawer" class="drawer" aria-hidden="true">
  <div class="drawer-head">
    <h2>ğŸ“Š Fahrdaten</h2>
    <button class="drawer-close" id="closeFahrdaten" aria-label="SchlieÃŸen">âœ•</button>
  </div>
  <div class="drawer-body" id="fahrdatenBody"></div>
</div>

<!-- Intro Video Overlay -->
<div id="introOverlay" class="intro-overlay">
  <div class="intro-content">
    <button class="intro-close" onclick="closeIntro()">âœ•</button>
    <video id="introVideo" controls autoplay muted playsinline>
      <source src="assets/intro.mp4" type="video/mp4">
    </video>
  </div>
</div>
