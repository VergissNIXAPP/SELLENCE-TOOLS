<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>SELLENCE ‚Ä¢ OOS Scanner</title>

  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <style>
    /* Minimal UI-Erg√§nzungen (falls style.css schon viel macht) */
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #121826;
      --muted: #6b7280;
      --border: rgba(17, 24, 39, 0.10);
      --accent: #2e007a; /* Sellence Logo Purple */
    }
    body {
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 40px;
    }
    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: 0 6px 20px rgba(0,0,0,.05);
    }
    .title {
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .title b { font-size: 16px; }
    .title span { color: var(--muted); font-size: 12px; }

    .card {
      margin-top: 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 10px 26px rgba(0,0,0,.05);
    }

    /* ===== Premium Upload Onboarding (nur Optik ‚Äì keine Logik) ===== */
    .uploadHero{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(46,0,122,.10), rgba(124,58,237,.06));
      border: 1px solid rgba(46,0,122,.14);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
      margin-bottom: 12px;
    }
    .uploadHero .hTitle{
      margin:0;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: .01em;
    }
    .uploadHero .hSub{
      margin-top: 4px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(17,24,39,.10);
      background:#fff;
      font-size: 12px;
      font-weight: 900;
      color:#111827;
      white-space:nowrap;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
    }
    .badgeDot{width:8px;height:8px;border-radius:999px;background: var(--accent); box-shadow: 0 0 0 3px rgba(46,0,122,.10);}

    .steps{
      display:grid;
      gap:10px;
    }
    .step{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(17,24,39,.10);
      background: #fff;
      box-shadow: 0 10px 22px rgba(0,0,0,.04);
    }
    .stepNum{
      flex:0 0 auto;
      width:30px;height:30px;
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      color:#fff;
      background: linear-gradient(180deg, rgba(46,0,122,.95), rgba(91,43,209,.85));
      box-shadow: 0 10px 18px rgba(46,0,122,.20);
    }
    .stepBody b{display:block;font-size:13px;font-weight: 900; margin:0 0 2px;}
    .stepBody span{display:block;color:var(--muted);font-size:12px;font-weight:700; line-height:1.35;}
    .kbd{display:inline-block;padding:2px 7px;border-radius:9px;border:1px solid rgba(17,24,39,.14);background:linear-gradient(#fff,#f5f6fb);font-weight:900;font-size:11px;color:#111827; box-shadow: inset 0 1px 0 rgba(255,255,255,.8);}

    .infoMini{
      margin-top: 8px;
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px dashed rgba(46,0,122,.22);
      background: rgba(124,58,237,.05);
    }
    .iBtn{
      flex:0 0 auto;
      width:26px;height:26px;
      border-radius: 10px;
      border: 1px solid rgba(46,0,122,.25);
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      color: var(--accent);
      box-shadow: 0 10px 18px rgba(46,0,122,.08);
    }
    .infoMini .t{
      font-size: 12px;
      font-weight: 800;
      color:#111827;
      line-height:1.35;
    }
    .infoMini .t span{display:block;color:var(--muted);font-weight:700;margin-top:2px;}

    .dropzone{
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid rgba(46,0,122,.18);
      background: linear-gradient(180deg, rgba(46,0,122,.06), rgba(255,255,255,1));
      box-shadow: 0 16px 34px rgba(0,0,0,.05);
      overflow:hidden;
    }
    .dropzoneTop{
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.65);
    }
    .dzTitle{font-weight: 1000; font-size: 13px;}
    .dzMeta{color: var(--muted); font-weight: 700; font-size: 12px;}
    .dropzoneBody{padding: 12px 12px 14px;}
    .uploadBtn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      width:100%;
      border-radius: 16px;
      padding: 13px 14px;
      background: linear-gradient(180deg, rgba(46,0,122,.98), rgba(91,43,209,.90));
      color:#fff;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 18px 30px rgba(46,0,122,.22);
      user-select:none;
      transition: transform 140ms ease, filter 140ms ease;
    }
    .uploadBtn:hover{filter:saturate(1.08)}
    .uploadBtn:active{transform: scale(.99)}
    .uploadNote{
      margin-top: 8px;
      display:flex;
      gap:8px;
      align-items:flex-start;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }
    .spark{
      width:18px;height:18px;border-radius:10px;
      background: rgba(46,0,122,.10);
      display:flex;align-items:center;justify-content:center;
      color: var(--accent);
      flex:0 0 auto;
      margin-top:1px;
    }

    .featureList{list-style:none;padding:0;margin:10px 0 0;display:grid;gap:8px;}
    .featureList li{display:flex;gap:10px;align-items:flex-start;color:#111827;font-size:12px;font-weight:800;line-height:1.35;}
    .check{
      width:18px;height:18px;border-radius:10px;
      background: rgba(34,197,94,.12);
      border:1px solid rgba(34,197,94,.22);
      display:flex;align-items:center;justify-content:center;
      color:#16a34a;
      flex:0 0 auto;
      margin-top:1px;
      font-weight: 1000;
    }

    .sideCard{
      border-radius: 18px;
      border: 1px solid rgba(17,24,39,.10);
      background: #fff;
      box-shadow: 0 10px 26px rgba(0,0,0,.04);
      padding: 12px 12px;
    }
    .sideCard h3{margin:0 0 6px 0;}
    .sideCard p{margin:0;color:var(--muted);font-size:12px;font-weight:700;line-height:1.4}
    .grid {
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
    }
    @media (max-width: 820px) {
      .grid { grid-template-columns: 1fr; }
    }
    .hint {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
      background: rgba(124,58,237,.06);
      border: 1px solid rgba(124,58,237,.18);
      padding: 12px 12px;
      border-radius: 14px;
    }
    .btn {
      appearance:none;
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 700;
      cursor:pointer;
      background: var(--accent);
      color: white;
      width: 100%;
      box-shadow: 0 10px 20px rgba(124,58,237,.25);
    }
    .btn.secondary {
      background: #111827;
      box-shadow: 0 10px 20px rgba(17,24,39,.2);
    }
    .btn:disabled {
      opacity:.6;
      cursor:not-allowed;
    }
    .row {
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .row .left {
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="file"] { display:none; }

    table {
      width:100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid var(--border);
      padding: 10px 8px;
      vertical-align: middle;
      text-align:left;
    }
    th { color: var(--muted); font-weight: 800; font-size: 12px; }
    .pill {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
    }
    .remove {
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 800;
    }
    .eanimg {
      height: 38px;
      max-width: 210px;
      object-fit: contain;
      display:block;
    }

    /* Scan overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(17,24,39,.55);
      backdrop-filter: blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 20px;
    }
    .overlay.on { display:flex; }
    .overlay .box {
      width: min(520px, 100%);
      background: white;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 50px rgba(0,0,0,.2);
    }
    .spinner {
      width: 18px; height: 18px;
      border-radius: 50%;
      border: 3px solid rgba(124,58,237,.25);
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Print */
    @media print {
      .topbar, .card:first-of-type, .no-print { display:none !important; }
      body { background:#fff; }
      .card { box-shadow:none; border:0; padding:0; }
      th, td { font-size: 11px; }
      .eanimg { height: 42px; }
    }
  
    /* Brand header */
    .topbar{
      position: relative;
      justify-content: center !important;
      text-align: center;
    }
    .topbar .pill{
      position:absolute;
      right:12px;
      top:50%;
      transform: translateY(-50%);
    }
    .brandTitle{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      line-height:1.0;
      margin: 0 auto;
      text-align:center;
    }
    .brandMain{
      font-weight: 900;
      font-size: 24px;
      letter-spacing: .14em;
      color: var(--accent);
      text-transform: uppercase;
    }
    .brandSub{
      font-weight: 900;
      font-size: 15px;
      letter-spacing: .10em;
      color: var(--accent);
      text-transform: uppercase;
    }
    .brandDesc{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .02em;
    }


    /* ===== OOS table readability ===== */
    #oosTable tbody td:first-child{ color:#111 !important; font-weight:800; }
    #oosTable thead th{ color:#111; }

    /* Status pill in export */
    .statusText{
      color:#b00020;
      font-weight:900;
    }
    .statusWrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .statusRemove{
      border:0;
      background:transparent;
      cursor:pointer;
      font-size:16px;
      line-height:1;
      padding:2px 6px;
      color:#666;
    }

    /* Export header */
    .exportHeader{
      display:block;
      /* Logo etwas h√∂her + mehr Luft zur √úberschrift */
      padding:8px 16px 10px;
      border-bottom:1px solid #e6e6e6;
      background:#fff;
    }
    .exportLogoRow{
      display:flex;
      align-items:center;
      justify-content:center;
      /* mehr Abstand zum Titel */
      margin-bottom:16px;
    }
    .exportLogo{ height:48px; width:auto; display:block; }
.exportTitleRow{
  display:none;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin: 0 0 10px 0;
}
.exportTitleText{
  font-weight:900;
  font-size:16px;
  color:#111;
}
    .exportLogoFallback{
      display:none;
      font-weight:900;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#2e007a;
      font-size:28px;
    }
    .exportMeta{
      display:grid;
      grid-template-columns: 1fr 1fr auto;
      gap:10px;
      align-items:end;
    }
    .exportField label{
      display:block;
      font-size:12px;
      color:#444;
      font-weight:800;
      margin-bottom:6px;
    }
    .exportField input{
      width:100%;
      padding:10px 12px;
      border:1px solid #d9d9d9;
      border-radius:10px;
      font-size:14px;
      outline:none;
      background:#fff;
      color:#111;
    }
    .exportDateField{ min-width: 190px; }
    .exportDate{
      padding:10px 12px;
      border:1px solid #d9d9d9;
      border-radius:10px;
      font-size:14px;
      font-weight:800;
      color:#111;
      background:#fafafa;
      white-space:nowrap;
    }

    /* Print fixes: DO NOT hide the OOS card; make everything black on white */
    @media print{
      body{ background:#fff !important; color:#111 !important; }
      .topbar{ display:none !important; }
      .card#uploadCard{ display:none !important; }
      .left.no-print, .no-print, .overlay{ display:none !important; }
      .card#oosCard{ display:block !important; background:#fff !important; box-shadow:none !important; border:0 !important; }
      .card#oosCard .row{ display:none !important; } /* Titelzeile im PDF ausblenden (wir nutzen Export-Title) */
      .exportHeader{ padding-top:0 !important; }
      .exportLogoRow{ margin-top:-2px !important; margin-bottom:18px !important; }
      .exportTitleRow{ display:flex !important; margin-bottom:12px !important; }

      .exportHeader{ display:block !important; padding-top:2px !important; }
      /* Nur im PDF: Logo etwas h√∂her + mehr Abstand zur √úberschrift */
      .exportLogoRow{ margin-top:0 !important; margin-bottom:22px !important; }
      #oosTable{ width:100%; }
      #oosTable thead th{ background:#f2f2f2 !important; color:#111 !important; }
      #oosTable td, #oosTable th{ border-color:#d9d9d9 !important; color:#111 !important; }
      #oosTable tbody td:first-child{ color:#111 !important; }
      .ean-col{ display:table-cell !important; }
      .action-col{ display:none !important; }
      .statusRemove{ display:none !important; } /* no buttons in PDF */
      @page{ size:A4 portrait; margin:10mm; }
    }


    /* Editable status field */
    .statusEdit{
      display:inline-block;
      min-width: 160px;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.08);
      background: #fff;
      font-weight: 900;
      color:#b00020;
      outline:none;
      cursor:text;
      user-select:text;
    }
    .statusEdit.is-empty{
      color:#777;
      font-weight:800;
    }
    .statusEdit:focus{
      border-color: rgba(46,0,122,.45);
      box-shadow: 0 0 0 3px rgba(46,0,122,.12);
    }
    .statusWrap{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .statusRemove{ border:0; background:transparent; cursor:pointer; font-size:16px; line-height:1; padding:2px 6px; color:#666; }
    .eanimg{ max-height: 46px; width:auto; display:block; }


    /* Export logo: only in PDF/print */
    .exportLogoRow{ display:none; }
    @media print{
      .exportLogoRow{ display:flex !important; }
    }

    /* Make input values bold like the date/time */
    .exportField input{
      font-weight: 800 !important;
    }

    /* Status: linksb√ºndig, x als Overlay (schiebt Inhalt nicht) */
    .statusWrap{
      position: relative !important;
      justify-content: flex-start !important;
    }
    .statusEdit{
      width: 100%;
      text-align: left;
      padding-right: 34px; /* space for x */
      padding-left: 12px;
    }
    .statusRemove{
      position:absolute;
      right:8px;
      top:50%;
      transform: translateY(-50%);
    }

</style>
</head>
<body>
  <script>try{if(localStorage.getItem("sellence_auth")!=="1"){location.href="index.html";}}</script>

<div class="wrap">
  <div class="topbar">
    <div class="title">
      <div class="brandTitle">
        <div class="brandMain">SELLENCE</div>
        <div class="brandSub">OUT OF STOCK SCANNER</div>
        <div class="brandDesc">Einfach. Schnell. Bestellt.</div>
      </div>
    </div>
    <div class="pill" id="pillStatus">Bereit</div>
  </div>

  <!-- START / UPLOAD -->
  <div class="card no-print" id="uploadCard">
    <div class="uploadHero">
      <div>
        <h3 class="hTitle">In wenigen Sekunden alle OOS-Bestellungen erledigen?</h3>
        <div class="hSub">Screenshot aus Ninox PRO hochladen ‚Üí Scanner erkennt die Produkte ‚Üí du exportierst eine saubere PDF inkl. EAN</div>
      </div>
      <div class="badge"><span class="badgeDot"></span> Schnellstart</div>
    </div>

    <div class="grid">
      <!-- LEFT: Steps + Upload -->
      <div>
        <div class="steps" aria-label="Schritte">
          <div class="step">
            <div class="stepNum">1</div>
            <div class="stepBody">
              <b>Ninox PRO √∂ffnen</b>
              <span>OOS‚ÄëListe aufrufen (nur die √úbersicht aller OOS Produkte nach Facing Check)</span>
            </div>
          </div>
          <div class="step">
            <div class="stepNum">2</div>
            <div class="stepBody">
              <b>Screenshot erstellen</b>
              <span class="kbdline">Am iPad: <span class="kbd">‚èª</span> + <span class="kbd">Vol‚Äì</span> gleichzeitig dr√ºcken</span>
            </div>
          </div>
          <div class="step">
            <div class="stepNum">3</div>
            <div class="stepBody">
              <b>Screenshot hochladen</b>
              <span>W√§hle den Screenshot aus ‚Äì die App startet den Scan automatisch.</span>
            </div>
          </div>
        </div>

        
      </div>

      <!-- RIGHT: What happens next -->
      <div>
        <div class="sideCard">
          <h3>Was passiert danach?</h3>
          <ul class="featureList">
            <li><span class="check">‚úì</span> OOS Produkte werden mit passender EAN angezeigt.</li>
            <li><span class="check">‚úì</span> Du kannst Eintr√§ge entfernen oder den Status bearbeiten.</li>
            <li><span class="check">‚úì</span> PDF exportieren, drucken oder per Mail an Tabakverantwortlichen √ºbergeben/senden.</li>
	<li><span class="check">‚úì</span>Win-Win ü´±üèª‚Äçü´≤üèª f√ºr Markt und Au√üendienst! üéâ</li>
          </ul>
        </div>

       
      </div>
    </div>

    <!-- CENTERED UPLOAD -->
    <div class="dropzone" aria-label="Upload">
          <div class="dropzoneTop dzCenter">
            <div>
              <div class="dzTitle">Screenshot Upload</div>
              <div class="dzMeta">PNG / JPG ‚Ä¢ vom iPad oder iPhone</div>
            </div>
            <span class="pill" style="background: rgba(46,0,122,.06); border-color: rgba(46,0,122,.14); color:#2e007a;">Scan bereit</span>
          </div>
          <div class="dropzoneBody dzCenterBody">
            <label class="uploadBtn" for="screenshotUpload" title="Screenshot ausw√§hlen">
              <span style="font-size:16px; line-height:1;">‚¨ÜÔ∏é</span>
              Screenshot ausw√§hlen
            </label>
            <input id="screenshotUpload" type="file" accept="image/*">
            <div class="uploadNote uploadNoteCenter">
              
              <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fragen oder Probleme?  andre.schorn@sellence.de  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</div>
            </div>
          </div>
        </div>

  </div>

  <!-- RESULTS -->
  <div class="card" id="oosCard" style="display:none;">
    <div class="row">
      <div class="left">
        <h3 style="margin:0;">OOS Liste (Out of Stock)</h3>
        <span class="pill" id="pillCount">0 Produkte</span>
      </div>
      <div class="left no-print">
        <button class="remove" id="btnNew">Neuer Screenshot</button>
        <button class="btn" id="btnPrint" style="width:auto;">PDF Export (Drucken)</button>
      </div>
    </div>
    <!-- PRINT / EXPORT HEADER -->
    <div class="exportHeader">
      <div class="exportLogoRow">
        <img class="exportLogo" src="assets/logo-sellence.png" alt="SELLENCE" onerror="this.style.display='none'">
        <div class="exportLogoFallback">SELLENCE</div>
      </div>
      <!-- PRINT TITLE ROW (only visible in PDF/Print) -->
      <div class="exportTitleRow">
        <div class="exportTitleText">OOS Liste (Out of Stock)</div>
        <span class="pill" id="pillCountPrint">0 Produkte</span>
      </div>

      <div class="exportMeta">
        <div class="exportField">
          <label>Marktname</label>
          <input id="marketName" type="text" placeholder="z.B. EDEKA Mustermann">
        </div>
        <div class="exportField">
          <label>Ihr Ansprechpartner</label>
          <input id="contactName" type="text" placeholder="z.B. Andre Schorn">
        </div>
        <div class="exportField exportDateField">
          <label>Datum / Uhrzeit</label>
          <div class="exportDate" id="exportDate">‚Äì</div>
        </div>
      </div>
    </div>


    <table id="oosTable">
      <thead>
        <tr>
          <th>Marke</th>
          <th>Produkt</th>
          <th>Status</th>
          <th>EAN</th>
          <th class="no-print">Aktion</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
</div>
</div>

<!-- SCAN OVERLAY -->
<div class="overlay" id="scanOverlay" aria-hidden="true">
  <div class="box">
    <div style="display:flex; align-items:center; gap:10px;">
      <div class="spinner"></div>
      <div>
        <b>Screenshot wird gescannt‚Ä¶</b><br>
        <span style="color:var(--muted); font-size:13px;" id="scanMsg">Auslesen l√§uft</span>
      </div>
    </div>
  </div>
</div>

<script>
  const data = [
  // =======================
  // IQOS / TEREA
  // =======================
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMA Kit Pebble Beige", price:null, content:"1 St√ºck", img:"assets/iqos/1045460-iqos-iluma-one-pebble-beige.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMA Kit Pebble Grey", price:null, content:"1 St√ºck", img:"assets/iqos/1045459-iqos-iluma-one-pebble-grey.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi Kit Breeze Blue", price:null, content:"1 St√ºck", img:"assets/iqos/1111589-iqos-iluma-i-kit-breeze-blue-regis-neu.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi ONE Kit Midnight Black", price:null, content:"1 St√ºck", img:"assets/iqos/1111595-iqos-iluma-i-kit-midnight-black-regis-neu.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi ONE Kit Vivid Terracotta", price:null, content:"1 St√ºck", img:"assets/iqos/1111607-iqos-iluma-i-one-vivid-terracotta-regis-neu.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Amber Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108971-terea-tabaksticks-amber-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Bronze Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108702-terea-tabaksticks-bronze-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Russet Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108295-terea-tabaksticks-russet-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Sienna Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108708-terea-tabaksticks-sienna-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Silver Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1109372-terea-tabaksticks-silver-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Teak Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108644-terea-tabaksticks-teak-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Turquoise Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108701-terea-tabaksticks-turquoise-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Warm Fuse Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108277-terea-tabaksticks-warm-fuse-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Yellow Green Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108703-terea-tabaksticks-yellow-green-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Yellow Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108987-terea-tabaksticks-yellow-pack.png"},

  // =======================
  // VEEV
  // =======================
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Blue Raspberry", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Blue_Raspberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Classic Mint", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Classic_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Grape", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Grape.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Mango", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Mango.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Passion Fruit Kiwi Guava", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Passion_Fruit_Kiwi_Guava.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Sour Apple", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Sour_Apple.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Strawberry", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Strawberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Watermelon", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Watermelon.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Velvet Black", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Velvet_Black.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Silky Grey", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Silky_Grey.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Freshy Green", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Freshy_Green.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Balanced Tobacco", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Balanced_Tobacco.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blue Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blue_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blue Raspberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blue_Raspberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blueberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blueberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Classic Tobacco", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Classic_Tobacco.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Green Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Green_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Ice Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Ice_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Mango", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Mango.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Peach", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Peach.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Sour Apple", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Sour_Apple.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Strawberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Strawberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Watermelon", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Watermelon.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Cherry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Cherry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Grape", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Grape.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Passion Fruit Kiwi Guava", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Passion_Fruit_Kiwi_Guava.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Red Berries", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Red_Berries.png"},

  // =======================
 // Zigaretten (nach Marke, Preis aufsteigend)
// =======================

// MARLBORO
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP-Box", price:8, content:"20 St√ºck", img:"assets/marlboro/1112018-malboro-crafted-gold-zigaretten-op.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP-Box", price:8, content:"20 St√ºck", img:"assets/marlboro/1112014-malboro-crafted-red-zigaretten-op.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109634-malboro-mix-op-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},

{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP 2XL-Box", price:10, content:"27 St√ºck", img:"assets/marlboro/1112020-malboro-crafted-gold-zigaretten-2xl.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP 2XL-Box", price:10, content:"27 St√ºck", img:"assets/marlboro/1112016-malboro-crafted-red-zigaretten-2xl.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109406-malboro-mix-xl-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},

{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1112020-malboro-crafted-gold-zigaretten-2xl.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1109634-malboro-mix-op-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1109783-malboro-red-2xl-zigaretten.png"},

{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 4XL-Box", price:15, content:"36 St√ºck", img:"assets/marlboro/1109662-malboro-gold-4xl-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 4XL-Box", price:15, content:"36 St√ºck", img:"assets/marlboro/1109876-malboro-red-4xl-zigaretten.png"},

{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP 7XL-Box", price:20, content:"60 St√ºck", img:"assets/marlboro/1113475-malboro-gold-crafted-7xl-zigaretten-schachtel.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP 7XL-Box", price:20, content:"60 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 7XL-Box", price:20, content:"52 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 7XL-Box", price:20, content:"52 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
{section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 9XL-Box", price:30, content:"80 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},

// L&M
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP XL-Box", price:10, content:"25 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 4XL-Box", price:15, content:"39 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 9XL-Box", price:28, content:"80 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
{section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},

// CHESTERFIELD
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Original OP-Box", price:8.6, content:"20 St√ºck", img:"assets/chesterfield/1111367-chesterfield-op-original-zigaretten-einzel.png"},
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Original OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/chesterfield/1111760-chesterfield-2xl-original-zigaretten.png"},
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP-Box", price:8.6, content:"20 St√ºck", img:"assets/chesterfield/1110813-chesterfield-op-blue-zigaretten-einzel.png"},
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP XL-Box", price:10, content:"25 St√ºck", img:"assets/chesterfield/1110813-chesterfield-op-blue-zigaretten-einzel.png"},
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/chesterfield/1113935-chesterfield-blue-zigaretten-2xl.png"},
{section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP 4XL-Box", price:15, content:"39 St√ºck", img:"assets/chesterfield/1113935-chesterfield-blue-zigaretten-2xl.png"},

// F6
{section:"Zigaretten", brand:"f6", name:"F6 Original OP-Box", price:8.6, content:"20 St√ºck", img:"assets/other/1109946-f6-zigaretten-original.png"},
{section:"Zigaretten", brand:"f6", name:"F6 Original OP XL-Box", price:10, content:"25 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
{section:"Zigaretten", brand:"f6", name:"F6 Original OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/other/1111626-f6-zigaretten-original-2xl.png"},
{section:"Zigaretten", brand:"f6", name:"f6 Original OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
{section:"Zigaretten", brand:"f6", name:"f6 Blue OP XL-Box", price:10, content:"25 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
{section:"Zigaretten", brand:"f6", name:"f6 Blue OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
  // =======================
  // DELIA
  // =======================
  {section:"VEEV", brand:"DELIA", name:"Delia Classic Red", price:null, content:"", img:"assets/delia/delia-classic-red.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"DELIA", name:"Delia Classic Gold", price:null, content:"", img:"assets/delia/delia-classic-gold.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"DELIA", name:"Delia Classic Green", price:null, content:"", img:"assets/delia/delia-classic-green.png", ean_text:"(EAN aus PDF)"},
  // =======================
  // LEVIA
  // =======================
  {section:"VEEV", brand:"LEVIA", name:"Levia Glacial", price:null, content:"", img:"assets/levia/levia-glacial.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"LEVIA", name:"Levia Dark Berry", price:null, content:"", img:"assets/levia/levia-dark-berry.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"LEVIA", name:"Levia Red Berry", price:null, content:"", img:"assets/levia/levia-red-berry.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"LEVIA", name:"Levia Exotic", price:null, content:"", img:"assets/levia/levia-exotic.png", ean_text:"(EAN aus PDF)"},
  {section:"VEEV", brand:"LEVIA", name:"Levia Alpine", price:null, content:"", img:"assets/levia/levia-alpine.png", ean_text:"(EAN aus PDF)"},

  // =======================
  // Erg√§nzungen
  // =======================
  {section:"Zigaretten", brand:"L&M", name:"L&M Cigarette Tobacco Red Pouch 30g", price:7.4, content:"30g", img:"assets/lm/l-m-cigarette-tobacco-red.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold Long OP-Box", price:9.1, content:"20 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},

];

  const EAN_FILE_MAP = {
  "chesterfieldbluekingsizefiltercigarillosopbox":"assets/ean/chesterfield/chesterfield-blue-king-size-filter-cigarillos-op-box.png",
  "chesterfieldbluekingsizefiltercigarillosopboxpack17stkgebinde":"assets/ean/chesterfield/Chesterfield Blue King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldblueop2xlbox":"assets/ean/chesterfield/chesterfield-blue-op-2xl-box.png",
  "chesterfieldblueopbox":"assets/ean/chesterfield/chesterfield-blue-op-box.png",
  "chesterfieldblueopxlbox":"assets/ean/chesterfield/chesterfield-blue-op-xl-box.png",
  "chesterfieldoriginalop2xlbox":"assets/ean/chesterfield/chesterfield-original-op-2xl-box.png",
  "chesterfieldoriginalopbox":"assets/ean/chesterfield/chesterfield-original-op-box.png",
  "chesterfieldoriginalopxlbox":"assets/ean/chesterfield/chesterfield-original-op-xl-box.png",
  "chesterfieldredkingsizefiltercigarillosopbox":"assets/ean/chesterfield/chesterfield-red-king-size-filter-cigarillos-op-box.png",
  "chesterfieldredkingsizefiltercigarillosopboxpack17stkgebinde":"assets/ean/chesterfield/Chesterfield Red King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldunpluggedred":"assets/ean/chesterfield/chesterfield-unplugged-red.png",
  "chesterfieldunpluggedredpouch30ggebinde":"assets/ean/chesterfield/Chesterfield Unplugged Red Pouch 30g Gebinde.png",
  "chesterfieldvolumetobaccoredbox135gmega":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Box 135g Mega.png",
  "chesterfieldvolumetobaccoredbox255ggiga":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Box 255g Giga.png",
  "chesterfieldvolumetobaccoreddose40gmgebinde":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Dose 40g M Gebinde.png",
  "chesterfieldvolumetobaccoredgiga":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-giga.png",
  "chesterfieldvolumetobaccoredm":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-m.png",
  "chesterfieldvolumetobaccoredmega":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-mega.png",
  "chesterfieldzigarettenblue5x39er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (5x39er).png",
  "chesterfieldzigarettenblue8x25er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (8x25er).png",
  "chesterfieldzigarettenblue8x31er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (8x31er).png",
  "chesterfieldzigarettenoriginal8x25er":"assets/ean/chesterfield/Chesterfield Zigaretten Original (8x25er).png",
  "chesterfieldzigarettenoriginal8x31er":"assets/ean/chesterfield/Chesterfield Zigaretten Original (8x31er).png",
  "deliaclassicgold":"assets/ean/delia/delia-classic-gold.png",
  "deliaclassicgreen":"assets/ean/delia/delia-classic-green.png",
  "deliaclassicred":"assets/ean/delia/delia-classic-red.png",
  "evezigaretten12010x20er":"assets/ean/other/Eve Zigaretten 120 (10x20er).png",
  "iqosilumaikitbreezeblue":"assets/ean/iqos/iqos-ilumai-kit-breeze-blue.png",
  "iqosilumaionekitmidnightblack":"assets/ean/iqos/iqos-ilumai-one-kit-midnight-black.png",
  "iqosilumaionekitvividterracotta":"assets/ean/iqos/iqos-ilumai-one-kit-vivid-terracotta.png",
  "iqosilumakitpebblebeige":"assets/ean/iqos/iqos-iluma-kit-pebble-beige.png",
  "iqosilumakitpebblegrey":"assets/ean/iqos/iqos-iluma-kit-pebble-grey.png",
  "leviaalpine":"assets/ean/levia/levia-alpine.png",
  "leviadarkberry":"assets/ean/levia/levia-dark-berry.png",
  "leviaexotic":"assets/ean/levia/levia-exotic.png",
  "leviaglacial":"assets/ean/levia/levia-glacial.png",
  "leviaredberry":"assets/ean/levia/levia-red-berry.png",
  "lmbluelabelop2xlbox":"assets/ean/lm/l-m-blue-label-op-2xl-box.png",
  "lmbluelabelopbox":"assets/ean/lm/l-m-blue-label-op-box.png",
  "lmbluelabelopxlbox":"assets/ean/lm/l-m-blue-label-op-xl-box.png",
  "lmcigarettetobaccored":"assets/ean/lm/l-m-cigarette-tobacco-red.png",
  "lmcigarettetobaccoredpouch30ggebinde":"assets/ean/lm/LM Cigarette Tobacco Red Pouch 30g Gebinde.png",
  "lmfiltercigarillosbluelabelopbox":"assets/ean/lm/l-m-filter-cigarillos-blue-label-op-box.png",
  "lmfiltercigarillosbluelabelopboxpack17stkgebinde":"assets/ean/lm/LM Filter Cigarillos Blue Label OP Box Pack 17 Stk Gebinde.png",
  "lmfiltercigarillosredlabelopbox":"assets/ean/lm/l-m-filter-cigarillos-redlabel-op-box.png",
  "lmfiltercigarillosredlabelopboxpack17stkgebinde":"assets/ean/lm/LM Filter Cigarillos Red Label OP Box Pack 17 Stk Gebinde.png",
  "lmredlabelop2xlbox":"assets/ean/lm/l-m-red-label-op-2xl-box.png",
  "lmredlabelop4xlbox":"assets/ean/lm/l-m-red-label-op-4xl-box.png",
  "lmredlabelop7xlbox":"assets/ean/lm/l-m-red-label-op-7xl-box.png",
  "lmredlabelop9xlbox":"assets/ean/lm/l-m-red-label-op-9xl-box.png",
  "lmredlabelopbox":"assets/ean/lm/l-m-red-label-op-box.png",
  "lmredlabelopxlbox":"assets/ean/lm/l-m-red-label-op-xl-box.png",
  "lmvolumetobaccobluedose39gmgebinde":"assets/ean/lm/LM Volume Tobacco Blue Dose 39g M Gebinde.png",
  "lmvolumetobaccobluem":"assets/ean/lm/l-m-volume-tobacco-blue-m.png",
  "lmvolumetobaccored":"assets/ean/lm/l-m-volume-tobacco-red.png",
  "lmvolumetobaccoredbeutel85g":"assets/ean/lm/LM Volume Tobacco Red Beutel 85g.png",
  "lmvolumetobaccoredbig":"assets/ean/lm/l-m-volume-tobacco-red-big.png",
  "lmvolumetobaccoredbox129gbig":"assets/ean/lm/LM Volume Tobacco Red Box 129g Big.png",
  "lmvolumetobaccoredbox185gmega":"assets/ean/lm/LM Volume Tobacco Red Box 185g Mega.png",
  "lmvolumetobaccoreddose39gmgebinde":"assets/ean/lm/LM Volume Tobacco Red Dose 39g M Gebinde.png",
  "lmvolumetobaccoreddose65glgebinde":"assets/ean/lm/LM Volume Tobacco Red Dose 65g L Gebinde.png",
  "lmvolumetobaccoredl":"assets/ean/lm/l-m-volume-tobacco-red-l.png",
  "lmvolumetobaccoredm":"assets/ean/lm/l-m-volume-tobacco-red-m.png",
  "lmvolumetobaccoredmega":"assets/ean/lm/l-m-volume-tobacco-red-mega.png",
  "lmzigarettenbluelabel10x20er":"assets/ean/lm/L&M Zigaretten Blue Label (10x20er).png",
  "lmzigarettenbluelabel5x39er":"assets/ean/lm/L&M Zigaretten Blue Label (5x39er).png",
  "lmzigarettenbluelabel6x39er":"assets/ean/lm/L&M Zigaretten Blue Label (6x39er).png",
  "lmzigarettenbluelabel8x20er":"assets/ean/lm/L&M Zigaretten Blue Label (8x20er).png",
  "lmzigarettenbluelabel8x25er":"assets/ean/lm/L&M Zigaretten Blue Label (8x25er).png",
  "lmzigarettenbluelabel8x31er":"assets/ean/lm/L&M Zigaretten Blue Label (8x31er).png",
  "lmzigarettenredlabel3x60er":"assets/ean/lm/L&M Zigaretten Red Label (3x60er).png",
  "lmzigarettenredlabel8x25er":"assets/ean/lm/L&M Zigaretten Red Label (8x25er).png",
  "lmzigarettenredlabel8x31er":"assets/ean/lm/L&M Zigaretten Red Label (8x31er).png",
  "lmzigarettenredlabellong10x20er":"assets/ean/lm/L&M Zigaretten Red Label Long (10x20er).png",
  "lmzigarettensimplyblue10x20er":"assets/ean/lm/L&M Zigaretten Simply Blue (10x20er).png",
  "marlborocraftedbox230gmega":"assets/ean/marlboro_tabak/Marlboro Crafted Box 230g Mega.png",
  "marlborocraftedgoldop2xlbox":"assets/ean/marlboro/marlboro-crafted-gold-op-2xl-box.png",
  "marlborocraftedgoldop7xlbox":"assets/ean/marlboro/marlboro-crafted-gold-op-7xl-box.png",
  "marlborocraftedgoldopbox":"assets/ean/marlboro/marlboro-crafted-gold-op-box.png",
  "marlborocraftedredop2xlbox":"assets/ean/marlboro/marlboro-crafted-red-op-2xl-box.png",
  "marlborocraftedredop7xlbox":"assets/ean/marlboro/marlboro-crafted-red-op-7xl-box.png",
  "marlborocraftedredopbox":"assets/ean/marlboro/marlboro-crafted-red-op-box.png",
  "marlborogoldop2xlbox":"assets/ean/marlboro/marlboro-gold-op-2xl-box.png",
  "marlborogoldop4xlbox":"assets/ean/marlboro/marlboro-gold-op-4xl-box.png",
  "marlborogoldop7xlbox":"assets/ean/marlboro/marlboro-gold-op-7xl-box.png",
  "marlborogoldopbox":"assets/ean/marlboro/marlboro-gold-op-box.png",
  "marlborogoldopxlbox":"assets/ean/marlboro/marlboro-gold-op-xl-box.png",
  "marlborogoldsoftlabelopsoft":"assets/ean/marlboro/marlboro-gold-soft-label-op-soft.png",
  "marlboromixop2xlbox":"assets/ean/marlboro/MARLBORO MIX OP 2XL-BOX.png",
  "marlboromixopbox":"assets/ean/marlboro/MARLBORO MIX OP-BOX.png",
  "marlboromixopxlbox":"assets/ean/marlboro/MARLBORO MIX OP XL-BOX.png",
  "marlboropremiumtobaccogold":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-gold.png",
  "marlboropremiumtobaccogolddose70gmgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Dose 70g M Gebinde.png",
  "marlboropremiumtobaccogoldm":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-gold-m.png",
  "marlboropremiumtobaccogoldpouch30ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Pouch 30g Gebinde.png",
  "marlboropremiumtobaccored":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red.png",
  "marlboropremiumtobaccoreddose103glgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 103g L Gebinde.png",
  "marlboropremiumtobaccoreddose155gxlgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 155g XL Gebinde.png",
  "marlboropremiumtobaccoreddose70gmgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 70g M Gebinde.png",
  "marlboropremiumtobaccoredl":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red-l.png",
  "marlboropremiumtobaccoredm":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red-m.png",
  "marlboropremiumtobaccoredpouch30ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Pouch 30g Gebinde.png",
  "marlboropremiumtobaccoschwarzepouch50ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Schwarze Pouch 50g Gebinde.png",
  "marlboropremiumtobaccozware":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-zware.png",
  "marlbororedlongopbox":"assets/ean/marlboro/MARLBORO RED LONG OP-BOX.png",
  "marlbororedop2xlbox":"assets/ean/marlboro/MARLBORO RED OP 2XL-BOX.png",
  "marlbororedop4xlbox":"assets/ean/marlboro/MARLBORO RED OP 4XL-BOX.png",
  "marlbororedop7xlbox":"assets/ean/marlboro/MARLBORO RED OP 7XL-BOX.png",
  "marlbororedop9xlbox":"assets/ean/marlboro/MARLBORO RED OP 9XL-BOX.png",
  "marlbororedopbox":"assets/ean/marlboro/MARLBORO RED OP-BOX.png",
  "marlbororedopxlbox":"assets/ean/marlboro/MARLBORO RED OP XL-BOX.png",
  "marlbororedsoftlabelopsoft":"assets/ean/marlboro/MARLBORO RED SOFT LABEL OP SOFT.png",
  "marlborozigarettencraftedgold10x20er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold (10x20er).png",
  "marlborozigarettencraftedgold2xl8x27er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold 2XL (8x27er).png",
  "marlborozigarettencraftedgold60er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold (60er).png",
  "marlborozigarettencraftedred10x20er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red (10x20er).png",
  "marlborozigarettencraftedred2xl8x27er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red 2XL (8x27er).png",
  "marlborozigarettencraftedred60er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red (60er).png",
  "marlborozigarettengold10x20er":"assets/ean/marlboro/Marlboro Zigaretten Gold (10x20er).png",
  "marlborozigarettengold3x52er":"assets/ean/marlboro/Marlboro Zigaretten Gold (3x52er).png",
  "marlborozigarettengold5x39er":"assets/ean/marlboro/Marlboro Zigaretten Gold (5x39er).png",
  "marlborozigarettengold8x23er":"assets/ean/marlboro/Marlboro Zigaretten Gold (8x23er).png",
  "marlborozigarettengoldlong10x20er":"assets/ean/marlboro/MARLBORO GOLD LONG OP-BOX.png",
  "marlborozigarettengoldsoftlabel10x20er":"assets/ean/marlboro/Marlboro Zigaretten Gold Soft Label (10x20er).png",
  "marlborozigarettenred8x20er":"assets/ean/marlboro/Marlboro Zigaretten Red (8x20er).png",
  "marlborozigarettenred8x25er":"assets/ean/marlboro/Marlboro Zigaretten Red (8x25er).png",
  "marlborozigarettensilverblue10x20er":"assets/ean/marlboro/Marlboro Zigaretten Silver Blue (10x20er).png",
  "marlborozigarettensimplyblue10x20er":"assets/ean/marlboro/Marlboro Zigaretten Simply Blue (10x20er).png",
  "marlborozigarettensimplyred10x20er":"assets/ean/marlboro/Marlboro Zigaretten Simply Red (10x20er).png",
  "marlborozigarettenwhite10x20er":"assets/ean/marlboro/Marlboro Zigaretten White (10x20er).png",
  "marlborozigarettenwhite5x39er":"assets/ean/marlboro/Marlboro Zigaretten White (5x39er).png",
  "marlborozigarettenwhite8x25er":"assets/ean/marlboro/Marlboro Zigaretten White (8x25er).png",
  "marlborozigarettenwhite8x25er2":"assets/ean/marlboro/Marlboro Zigaretten White (8x25er) (2).png",
  "marlborozigarettenwhite8x31er":"assets/ean/marlboro/Marlboro Zigaretten White (8x31er).png",
  "parliamentzigarettennightblue10x20er":"assets/ean/other/Parliament Zigaretten Night Blue (10x20er).png",
  "pielrojarollingtobacco":"assets/ean/other/pielroja-rolling-tobacco.png",
  "pielrojarollingtobaccopouch30ggebinde":"assets/ean/other/Pielroja Rolling Tobacco Pouch 30g Gebinde.png",
  "tereaamberselection":"assets/ean/terea/terea-amber-selection.png",
  "tereabronzeselection":"assets/ean/terea/terea-bronze-selection.png",
  "terearussetselection":"assets/ean/terea/terea-russet-selection.png",
  "tereasiennaselection":"assets/ean/terea/terea-sienna-selection.png",
  "tereasilverselection":"assets/ean/terea/terea-silver-selection.png",
  "tereateakselection":"assets/ean/terea/terea-teak-selection.png",
  "tereaturquoiseselection":"assets/ean/terea/terea-turquoise-selection.png",
  "tereawarmfuseselection":"assets/ean/terea/terea-warm-fuse-selection.png",
  "tereayellowgreenselection":"assets/ean/terea/terea-yellow-green-selection.png",
  "tereayellowselection":"assets/ean/terea/terea-yellow-selection.png",
  "veevnowultrablueraspberry":"assets/ean/veev/veev-now-ultra-blue-raspberry.png",
  "veevnowultraclassicmint":"assets/ean/veev/veev-now-ultra-classic-mint.png",
  "veevnowultrafruitkiwiguavaveev":"assets/ean/veev/veev-now-ultra-fruit-kiwi-guava-veev.png",
  "veevnowultragrape":"assets/ean/veev/veev-now-ultra-grape.png",
  "veevnowultramango":"assets/ean/veev/veev-now-ultra-mango.png",
  "veevnowultrasourapple":"assets/ean/veev/veev-now-ultra-sour-apple.png",
  "veevnowultrastrawberry":"assets/ean/veev/veev-now-ultra-strawberry.png",
  "veevnowultrawatermelon":"assets/ean/veev/veev-now-ultra-watermelon.png",
  "veevonekitfreshygreen":"assets/ean/veev/veev-one-kit-freshy-green.png",
  "veevonekitsilkygrey":"assets/ean/veev/veev-one-kit-silky-grey.png",
  "veevonekitvelvetblack":"assets/ean/veev/veev-one-kit-velvet-black.png",
  "veevonepodsbalancedtobacco":"assets/ean/veev/veev-one-pods-balanced-tobacco.png",
  "veevonepodsblueberry":"assets/ean/veev/veev-one-pods-blueberry.png",
  "veevonepodsbluemint":"assets/ean/veev/veev-one-pods-blue-mint.png",
  "veevonepodsblueraspberry":"assets/ean/veev/veev-one-pods-blue-raspberry.png",
  "veevonepodscherry":"assets/ean/veev/veev-one-pods-cherry.png",
  "veevonepodsclassictobacco":"assets/ean/veev/veev-one-pods-classic-tobacco.png",
  "veevonepodsgrape":"assets/ean/veev/veev-one-pods-grape.png",
  "veevonepodsgreenmint":"assets/ean/veev/veev-one-pods-green-mint.png",
  "veevonepodsicemint":"assets/ean/veev/veev-one-pods-ice-mint.png",
  "veevonepodsmango":"assets/ean/veev/veev-one-pods-mango.png",
  "veevonepodspassionfruitkiwiguava":"assets/ean/veev/veev-one-pods-passion-fruit-kiwi-guava.png",
  "veevonepodspeach":"assets/ean/veev/veev-one-pods-peach.png",
  "veevonepodssourapple":"assets/ean/veev/veev-one-pods-sour-apple.png",
  "veevonepodsstrawberry":"assets/ean/veev/veev-one-pods-strawberry.png",
  "veevonepodswatermelon":"assets/ean/veev/veev-one-pods-watermelon.png",
  "lmcigarettetobaccoredpouch30g":"assets/ean/lm/l-m-cigarette-tobacco-red-pouch-30g.png",
  "marlborogoldlongopbox":"assets/ean/marlboro/MARLBORO GOLD LONG OP-BOX.png"
};

  // --- Helpers
  function normalizeText(t){
    return (t||"")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/‚Ç¨/g,"euro")
      .replace(/[^a-z0-9]+/g," ")
      .replace(/\s+/g," ")
      .trim();
  }
  function normalizeKey(t){
    return normalizeText(t).replace(/\s+/g,"");
  }
  function uniq(arr){
    return Array.from(new Set(arr));
  }

  function getEanImgForProduct(p){
    const key = normalizeKey(p.name);
    return EAN_FILE_MAP[key] || null;
  }

  // Build searchable tokens
  const catalog = data.map((p, idx)=>{
    const full = `${p.brand||""} ${p.name||""} ${p.content||""}`;
    const norm = normalizeText(full);
    // Split tokens but keep useful ones
    const tokens = uniq(norm.split(" ").filter(x=>x && x.length>=3));
    return {...p, idx, _norm:norm, _tokens:tokens};
  });

  // Matching: product counts as present in OCR text if enough tokens appear
  function matchFromOcrText(rawText){
    // OCR from Ninox often returns each row in ONE long line that also contains
    // status badges ("In Lieferung") and right-side counts ("1 Produkt").
    // We therefore CLEAN lines instead of discarding them.
    const linesRaw = (rawText||"")
      .split(/\r?\n/)
      .map(l=>l.trim())
      .filter(Boolean);

    const BRAND_HINTS = ["iqos","terea","veev","levia","delia","marlboro","chesterfield","l&m","lm"];
    const STOP = new Set([
      "euro","eur","lieferung","in","massnahme","ma√ünahme","verweigert",
      "produkt","produkte","stk","stuck","st√ºck","box","op","kit","one","xl","xxl","long",
      "red","blue","gold","green","black" // keep as tokens in product list; we'll not stop them in product tokens
    ]);

    function cleanLine(s){
      let x = (s||"");
      // remove status badges / ui words but keep product text
      x = x.replace(/ma√ünahme\s*verweigert/ig," ");
      x = x.replace(/in\s*lieferung/ig," ");
      x = x.replace(/\b\d+\s*produkt(e)?\b/ig," ");
      x = x.replace(/\s{2,}/g," ").trim();
      return x;
    }

    function hasBrandHint(n){
      return BRAND_HINTS.some(b=> n.includes(b.replace("&","")) || n.includes(b));
    }

    // Build candidate lines
    const candidateLines = [];
    for(const l of linesRaw){
      const cleaned = cleanLine(l);
      const n = normalizeText(cleaned);

      // must contain some letters
      if(!/[a-z√§√∂√º]/i.test(cleaned)) continue;

      // If there is a price OR a brand hint, accept it.
      const hasEuro = /‚Ç¨|eur/i.test(cleaned);
      const hasPrice = /\b\d{1,3}(?:[.,]\d{1,2})\b/.test(cleaned); // e.g. 7,40 / 9.90
      if(!(hasEuro || hasPrice || hasBrandHint(n))) continue;

      // Remove trailing price segment to focus matching on product name
      const n2 = n
        .replace(/\s*[-‚Äì‚Äî]?\s*\d{1,3}(?:[.,]\d{1,2})\s*(euro|eur)?\b.*$/,"")
        .trim();

      // tokenize
      const toks = uniq(n2.split(" ").filter(t=>t && t.length>=3));
      if(!toks.length) continue;

      candidateLines.push({raw:l, cleaned, norm:n2, toks});
    }

    // If OCR merges everything into very few lines, also try splitting by "‚Ç¨" separators
    if(candidateLines.length === 0 && rawText){
      const parts = rawText.split(/‚Ç¨|eur/ig).map(p=>p.trim()).filter(Boolean);
      for(const p of parts){
        const cleaned = cleanLine(p);
        const n = normalizeText(cleaned);
        if(!hasBrandHint(n)) continue;
        const toks = uniq(n.split(" ").filter(t=>t && t.length>=3));
        if(toks.length) candidateLines.push({raw:p, cleaned, norm:n, toks});
      }
    }

    // Similarity scoring (token overlap ratio + brand bonus)
    function scoreLineToProduct(li, p){
      let overlap = 0;
      for(const t of li.toks){
        if(p._tokens.includes(t)) overlap++;
      }
      const ratio = overlap / Math.max(1, Math.min(li.toks.length, 8));
      const brandTok = normalizeText(p.brand||"").split(" ").filter(Boolean);
      const brandHit = brandTok.some(bt=> bt.length>=2 && li.norm.includes(bt));
      return ratio + (brandHit ? 0.15 : 0);
    }

    const picked = [];
    const usedNames = new Set();

    for(const li of candidateLines){
      let best = null;
      let bestScore = 0;

      for(const p of catalog){
        const s = scoreLineToProduct(li, p);
        if(s > bestScore){
          bestScore = s;
          best = p;
        }
      }

      // Threshold tuned for Ninox rows
      if(best && bestScore >= 0.45 && !usedNames.has(best.name)){
        usedNames.add(best.name);
        picked.push(best);
      }
    }

    // If we still got an absurd amount of hits, tighten the threshold
    if(picked.length > 25){
      const tightened = [];
      usedNames.clear();
      for(const li of candidateLines){
        let best = null, bestScore = 0;
        for(const p of catalog){
          const s = scoreLineToProduct(li, p);
          if(s > bestScore){ bestScore=s; best=p; }
        }
        if(best && bestScore >= 0.60 && !usedNames.has(best.name)){
          usedNames.add(best.name);
          tightened.push(best);
        }
      }
      return tightened;
    }

    return picked;
  }

  // OCR pipeline
  async function preprocessToDataURL(file){
    const img = await createImageBitmap(file);

    // Crop to the left content area to remove right-side "1 Produkt" column and reduce false OCR noise.
    // Ninox layout is consistent on iPad screenshots.
    const srcX = Math.round(img.width * 0.02);
    const srcY = Math.round(img.height * 0.10);   // remove iOS top bar
    const srcW = Math.round(img.width * 0.84);    // keep left ~84% (product text + price + status badge)
    const srcH = Math.round(img.height * 0.78);   // remove bottom whitespace

    const maxW = 2400;
    const scale = Math.min(1, maxW / srcW);
    const w = Math.round(srcW * scale);
    const h = Math.round(srcH * scale);

    const canvas = document.createElement("canvas");
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext("2d");

    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(img, srcX, srcY, srcW, srcH, 0, 0, w, h);

    // Contrast boost + grayscale (helps with the light UI)
    const id = ctx.getImageData(0,0,w,h);
    const d = id.data;
    for(let i=0;i<d.length;i+=4){
      const r=d[i], g=d[i+1], b=d[i+2];
      let y = 0.2126*r + 0.7152*g + 0.0722*b;
      // simple contrast
      y = (y - 128) * 1.25 + 128;
      y = Math.max(0, Math.min(255, y));
      d[i]=d[i+1]=d[i+2]=y;
    }
    ctx.putImageData(id,0,0);

    return canvas.toDataURL("image/png", 0.92);
  }

  // UI
  const elOverlay = document.getElementById("scanOverlay");
  const elScanMsg = document.getElementById("scanMsg");
  const elPillStatus = document.getElementById("pillStatus");
  const elOosCard = document.getElementById("oosCard");
  const elUploadCard = document.getElementById("uploadCard");
  const elPillCount = document.getElementById("pillCount");
  const elPillCountPrint = document.getElementById("pillCountPrint");
  const elTableBody = document.querySelector("#oosTable tbody");
  const input = document.getElementById("screenshotUpload");

  let lastOcrText = "";
  let oos = [];

  function setOverlay(on, msg="OCR l√§uft"){
    elOverlay.classList.toggle("on", !!on);
    elScanMsg.textContent = msg;
  }

  function renderTable(){
    elTableBody.innerHTML = "";
    const countText = `${oos.length} Produkt${oos.length===1?"":"e"}`;
    elPillCount.textContent = countText;
    if(elPillCountPrint) elPillCountPrint.textContent = countText;
    elPillStatus.textContent = oos.length ? `OOS: ${oos.length}` : "0 Treffer";

    for(const p of oos){
      const tr = document.createElement("tr");

      const tdBrand = document.createElement("td");
      tdBrand.textContent = p.brand || "";
      tr.appendChild(tdBrand);

      const tdName = document.createElement("td");
      tdName.textContent = p.name || "";
      tr.appendChild(tdName);


      // STATUS (editable)
      if(p._status === undefined) p._status = "Bitte bestellen!";
      const tdStatus = document.createElement("td");

      const wrap = document.createElement("div");
      wrap.className = "statusWrap";

      const status = document.createElement("span");
      status.className = "statusEdit" + (((p._status || "").trim()) ? "" : " is-empty");
      status.contentEditable = "true";
      status.spellcheck = false;
      status.textContent = (p._status || "").trim() ? p._status : "";

      const syncStatus = ()=>{
        const val = (status.textContent || "").replace(/\u00A0/g," ").trim();
        p._status = val;
        status.className = "statusEdit" + (val ? "" : " is-empty");
      };
      status.addEventListener("input", syncStatus);
      status.addEventListener("blur", syncStatus);

      const xbtn = document.createElement("button");
      xbtn.className = "statusRemove no-print";
      xbtn.type = "button";
      xbtn.textContent = "√ó";
      xbtn.title = "Status l√∂schen";
      xbtn.addEventListener("click", ()=>{
        status.textContent = "";
        p._status = "";
        status.className = "statusEdit is-empty";
      });

      wrap.appendChild(status);
      wrap.appendChild(xbtn);
      tdStatus.appendChild(wrap);
      tr.appendChild(tdStatus);


      const tdEan = document.createElement("td");
      const imgPath = getEanImgForProduct(p);
      if(imgPath){
        const img = document.createElement("img");
        img.src = imgPath;
        img.className = "eanimg";
        img.alt = "EAN";
        tdEan.appendChild(img);
      } else {
        // fallback (falls du noch keine EAN-Bilder hast)
        tdEan.textContent = p.ean_text || "‚Äî";
        tdEan.style.color = "var(--muted)";
        tdEan.style.fontWeight = "700";
      }
      tr.appendChild(tdEan);

      const tdAct = document.createElement("td");
      tdAct.className = "no-print";
      const btn = document.createElement("button");
      btn.className = "remove";
      btn.textContent = "Entfernen";
      btn.addEventListener("click", ()=>{
        oos = oos.filter(x => normalizeKey(x.name) !== normalizeKey(p.name));
        renderTable();
      });
      tdAct.appendChild(btn);
      tr.appendChild(tdAct);

      elTableBody.appendChild(tr);
    }
  }

  function showResults(){
    elUploadCard.style.display = "none";
    elOosCard.style.display = "block";
    elOosCard.scrollIntoView({behavior:"smooth", block:"start"});
  }

  function reset(){
    oos = [];
    lastOcrText = "";
    renderTable();
    elOosCard.style.display = "none";
    elUploadCard.style.display = "block";
    elPillStatus.textContent = "Bereit";
    input.value = "";
    window.scrollTo({top:0, behavior:"smooth"});
  }

  document.getElementById("btnNew").addEventListener("click", reset);
  document.getElementById("btnPrint").addEventListener("click", ()=>window.print());
input.addEventListener("change", async (e)=>{
    const file = e.target.files && e.target.files[0];
    if(!file) return;

    if(!window.Tesseract){
      alert("OCR Engine (Tesseract) konnte nicht geladen werden (offline?).");
      return;
    }

    try {
      setOverlay(true, "Bild wird vorbereitet‚Ä¶");
      const dataUrl = await preprocessToDataURL(file);

      setOverlay(true, "Scanner erkennt Text‚Ä¶");
      const res = await Tesseract.recognize(dataUrl, "deu+eng", {
        tessedit_pageseg_mode: 6,
        preserve_interword_spaces: 1,
        logger: m => {
          if(m && m.status) {
            if(m.progress!=null) {
              setOverlay(true, `${m.status} ‚Äì ${Math.round(m.progress*100)}%`);
            } else {
              setOverlay(true, m.status);
            }
          }
        }
      });
      lastOcrText = (res && res.data && res.data.text) ? res.data.text : "";

      setOverlay(true, "Produkte werden abgeglichen‚Ä¶");
      oos = matchFromOcrText(lastOcrText);

      setOverlay(false);
      renderTable();
      showResults();
    } catch(err) {
      console.error(err);
      setOverlay(false);
      alert("Fehler beim Scannen. √ñffne die Konsole f√ºr Details.");
    }
  });

  // initial
  renderTable();

  // Live export date/time
  const exportDateEl = document.getElementById("exportDate");
  function updateExportDate(){
    if(!exportDateEl) return;
    const d = new Date();
    const pad = (n)=>String(n).padStart(2,"0");
    exportDateEl.textContent = `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  }
  updateExportDate();
  setInterval(updateExportDate, 1000);

</script>
</body>
</html>
